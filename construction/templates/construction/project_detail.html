{% extends 'construction/base.html' %}

{% block title %}{{ project.name }} - Project Details{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2>🏗️ {{ project.name }}</h2>
        <a href="{% url 'project_list' %}" class="btn" style="background: #6c757d;">↩️ Back to Projects</a>
    </div>
    
    <!-- Project Overview Card -->
    <div class="card priority-{{ project.priority|lower }}" style="margin-bottom: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <span class="status-badge status-{{ project.status|lower|cut:' ' }}" style="font-size: 14px;">
                {{ project.status }}
            </span>
            <span style="font-size: 18px; font-weight: bold;">
                Priority: {{ project.priority }}
            </span>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 20px;">
            <div>
                <h4 style="color: #333; margin-bottom: 15px;">📋 Project Information</h4>
                <p><strong>📍 Location:</strong> {{ project.location }}</p>
                <p><strong>💰 Budget:</strong> ${{ project.budget|floatformat:2 }}</p>
                <p><strong>👨‍💼 Manager:</strong> {{ project.manager.username }}</p>
                <p><strong>🕒 Created:</strong> {{ project.created_at|date:"M d, Y g:i A" }}</p>
                {% if project.updated_at != project.created_at %}
                    <p><strong>📝 Last Updated:</strong> {{ project.updated_at|date:"M d, Y g:i A" }}</p>
                {% endif %}
            </div>
            
            <div>
                <h4 style="color: #333; margin-bottom: 15px;">📅 Timeline</h4>
                <p><strong>🚀 Start Date:</strong> {{ project.start_date }}</p>
                <p><strong>🏁 End Date:</strong> {{ project.end_date }}</p>
                {% if project.document %}
                    <div style="margin-top: 15px;">
                        <strong>📄 Document:</strong><br>
                        {% if document_url %}
                            <a href="{{ document_url }}" target="_blank" class="btn" style="padding: 8px 16px; font-size: 14px; margin-top: 5px;">
                                📁 View Document (S3)
                            </a>
                        {% else %}
                            <span style="color: #666;">Document available in S3</span>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div>
            <h4 style="color: #333; margin-bottom: 10px;">📝 Description</h4>
            <p style="line-height: 1.6; color: #555;">{{ project.description }}</p>
        </div>
    </div>
    
    <!-- Edit Form -->
    <div class="card">
        <h3 style="margin-bottom: 20px;">✏️ Edit Project</h3>
        
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="action" value="update">
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label for="name">🏗️ Project Name:</label>
                    <input type="text" id="name" name="name" value="{{ project.name }}" required>
                </div>
                
                <div class="form-group">
                    <label for="location">📍 Location:</label>
                    <input type="text" id="location" name="location" value="{{ project.location }}" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="description">📝 Description:</label>
                <textarea id="description" name="description" required>{{ project.description }}</textarea>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label for="start_date">📅 Start Date:</label>
                    <input type="date" id="start_date" name="start_date" value="{{ project.start_date|date:'Y-m-d' }}" required>
                </div>
                
                <div class="form-group">
                    <label for="end_date">🏁 End Date:</label>
                    <input type="date" id="end_date" name="end_date" value="{{ project.end_date|date:'Y-m-d' }}" required>
                </div>
                
                <div class="form-group">
                    <label for="budget">💰 Budget ($):</label>
                    <input type="number" id="budget" name="budget" step="0.01" min="0" value="{{ project.budget }}" required>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="form-group">
                    <label for="status">📊 Status:</label>
                    <select id="status" name="status" required>
                        <option value="Planning" {% if project.status == "Planning" %}selected{% endif %}>🗓️ Planning</option>
                        <option value="In Progress" {% if project.status == "In Progress" %}selected{% endif %}>🔄 In Progress</option>
                        <option value="Completed" {% if project.status == "Completed" %}selected{% endif %}>✅ Completed</option>
                        <option value="On Hold" {% if project.status == "On Hold" %}selected{% endif %}>⏸️ On Hold</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="priority">⚡ Priority:</label>
                    <select id="priority" name="priority" required>
                        <option value="Low" {% if project.priority == "Low" %}selected{% endif %}>🟢 Low</option>
                        <option value="Medium" {% if project.priority == "Medium" %}selected{% endif %}>🟡 Medium</option>
                        <option value="High" {% if project.priority == "High" %}selected{% endif %}>🟠 High</option>
                        <option value="Critical" {% if project.priority == "Critical" %}selected{% endif %}>🔴 Critical</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label for="document">📄 Upload New Document (Optional):</label>
                <input type="file" id="document" name="document" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png">
                <small style="color: #666; display: block; margin-top: 5px;">
                    📁 New file will replace existing document in AWS S3
                </small>
            </div>
            
            <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                <button type="submit" class="btn">💾 Update Project</button>
            </div>
        </form>
    </div>
    
    <!-- Danger Zone -->
    <div class="card" style="border-left-color: #dc3545; background: #fff5f5;">
        <h3 style="color: #dc3545; margin-bottom: 20px;">⚠️ Danger Zone</h3>
        <p style="margin-bottom: 20px; color: #666;">
            Once you delete this project, there is no going back. This action cannot be undone.
        </p>
        
        <form method="post" onsubmit="return confirm('Are you sure you want to delete this project? This action cannot be undone!')">
            {% csrf_token %}
            <input type="hidden" name="action" value="delete">
            <button type="submit" class="btn btn-danger">🗑️ Delete Project</button>
        </form>
    </div>
</div>

<div style="margin-top: 40px; padding: 20px; background: #e3f2fd; border-radius: 10px;">
    <h4 style="color: #1976d2; margin-bottom: 10px;">📊 AWS Integration Status</h4>
    <ul style="color: #333; line-height: 1.8;">
        <li>✅ <strong>CloudWatch Logging:</strong> All activities are being logged</li>
        <li>✅ <strong>S3 Storage:</strong> Documents stored securely</li>
        <li>✅ <strong>SES Email:</strong> Notifications sent for updates</li>
        <li>✅ <strong>SNS Alerts:</strong> Push notifications for critical priorities</li>
        <li>✅ <strong>RDS Ready:</strong> Database schema compatible with MySQL</li>
    </ul>
</div>

<script>
// Set minimum date validation
document.getElementById('start_date').addEventListener('change', function() {
    document.getElementById('end_date').min = this.value;
});

// Initialize with current start date
document.getElementById('end_date').min = document.getElementById('start_date').value;
</script>
{% endblock %}
